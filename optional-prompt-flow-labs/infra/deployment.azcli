# Make sure you log out from other tenants (only if you skipped configure budget step)
az logout

# Sign into the Azure CLI (only if you skipped configure budget step)
# EXAMPLE: az login --tenant 00000000-0000-0000-0000-000000000000
# REPLACE: <YOUR_TENANT_ID>
az login --tenant <YOUR_TENANT_ID>

# Check if resource providers registered
az provider show --namespace Microsoft.Quota --query "registrationState"
az provider show --namespace Microsoft.CognitiveServices --query "registrationState"
az provider show --namespace Microsoft.Storage --query "registrationState"
az provider show --namespace Microsoft.MachineLearningServices --query "registrationState"
az provider show --namespace Microsoft.Search --query "registrationState"
az provider show --namespace Microsoft.AlertsManagement --query "registrationState"
az provider show --namespace Microsoft.PolicyInsights --query "registrationState"
az provider show --namespace Microsoft.Authorization --query "registrationState"

# Register resource providers (run only those which are not registered)
az provider register --namespace Microsoft.Quota --wait
az provider register --namespace Microsoft.CognitiveServices --wait
az provider register --namespace Microsoft.Storage --wait
az provider register --namespace Microsoft.MachineLearningServices --wait
az provider register --namespace Microsoft.Search --wait
az provider register --namespace Microsoft.AlertsManagement --wait
az provider register --namespace Microsoft.PolicyInsights --wait
az provider register --namespace Microsoft.Authorization --wait

# Create Resource groups
# You can change the region to your preferred one, but make sure the Azure OpenAI Service and Azure AI Search semantic ranker are available in that region.
az group create -l swedencentral -n ns25-pf-rg

# Deploy resources
# EXAMPLE: deploymentPrincipalId=00000000-0000-0000-0000-000000000000
# REPLACE: <YOUR_PRINCIPAL_ID>
# The deployment may take up to 10 minutes to complete
az deployment group create --resource-group ns25-pf-rg --template-file ".\infra\template.bicep" --parameters name=ns25pf deploymentPrincipalId=<YOUR_PRINCIPAL_ID> aiHubFriendlyName="AI Hub - Nordic Summit 2025 - Prompt Flow" aiProjectFriendlyName="AI Hub Project - Nordic Summit 2025 - Prompt Flow" aiHubDescription="Azure AI Foundry Hub for the Nordic Summit 2025 - Prompt Flow project." tags='{\"purpose\": \"ns25-demo-test\"}'
